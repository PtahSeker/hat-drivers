<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.1.0"/>
    <title>hat.drivers.iec60870.apci API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(:first-of-type){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section:first-of-type details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../iec60870.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;hat.drivers.iec60870</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="variable" href="#Bytes">Bytes</a>
            </li>
            <li>
                    <a class="class" href="#SequenceNumber">SequenceNumber</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SequenceNumber.__init__">SequenceNumber</a>
                        </li>
                        <li>
                                <a class="function" href="#SequenceNumber.conjugate">conjugate</a>
                        </li>
                        <li>
                                <a class="function" href="#SequenceNumber.bit_length">bit_length</a>
                        </li>
                        <li>
                                <a class="function" href="#SequenceNumber.bit_count">bit_count</a>
                        </li>
                        <li>
                                <a class="function" href="#SequenceNumber.to_bytes">to_bytes</a>
                        </li>
                        <li>
                                <a class="function" href="#SequenceNumber.from_bytes">from_bytes</a>
                        </li>
                        <li>
                                <a class="function" href="#SequenceNumber.as_integer_ratio">as_integer_ratio</a>
                        </li>
                        <li>
                                <a class="variable" href="#SequenceNumber.real">real</a>
                        </li>
                        <li>
                                <a class="variable" href="#SequenceNumber.imag">imag</a>
                        </li>
                        <li>
                                <a class="variable" href="#SequenceNumber.numerator">numerator</a>
                        </li>
                        <li>
                                <a class="variable" href="#SequenceNumber.denominator">denominator</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#ConnectionCb">ConnectionCb</a>
            </li>
            <li>
                    <a class="function" href="#connect">connect</a>
            </li>
            <li>
                    <a class="function" href="#listen">listen</a>
            </li>
            <li>
                    <a class="class" href="#Server">Server</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Server.__init__">Server</a>
                        </li>
                        <li>
                                <a class="variable" href="#Server.async_group">async_group</a>
                        </li>
                        <li>
                                <a class="variable" href="#Server.addresses">addresses</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Connection">Connection</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Connection.__init__">Connection</a>
                        </li>
                        <li>
                                <a class="variable" href="#Connection.async_group">async_group</a>
                        </li>
                        <li>
                                <a class="variable" href="#Connection.info">info</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.send">send</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.drain">drain</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.receive">receive</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
hat<wbr>.<a href="./../../drivers.html">drivers</a><wbr>.<a href="./../iec60870.html">iec60870</a><wbr>.apci    </h1>

                        <div class="docstring"><p>IEC 60870-5 APCI layer</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="L-0"><a href="#L-0"><span class="linenos"> 0</span></a><span class="sd">&quot;&quot;&quot;IEC 60870-5 APCI layer&quot;&quot;&quot;</span>
</span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span> <span class="nn">hat.drivers.iec60870.apci.common</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Bytes</span><span class="p">,</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>                                              <span class="n">SequenceNumber</span><span class="p">)</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">hat.drivers.iec60870.apci.connection</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ConnectionCb</span><span class="p">,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>                                                  <span class="n">connect</span><span class="p">,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>                                                  <span class="n">listen</span><span class="p">,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>                                                  <span class="n">Server</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>                                                  <span class="n">Connection</span><span class="p">)</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bytes&#39;</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>           <span class="s1">&#39;SequenceNumber&#39;</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>           <span class="s1">&#39;ConnectionCb&#39;</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>           <span class="s1">&#39;connect&#39;</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>           <span class="s1">&#39;listen&#39;</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>           <span class="s1">&#39;Server&#39;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>           <span class="s1">&#39;Connection&#39;</span><span class="p">]</span>
</span></pre></div>

        </details>

            </section>
                <section id="Bytes">
                                <div class="attr variable"><a class="headerlink" href="#Bytes">#&nbsp;&nbsp</a>

        <span class="name">Bytes</span><span class="default_value"> = typing.Union[bytes, bytearray, memoryview]</span>
    </div>

    
    

                </section>
                <section id="SequenceNumber">
                                <div class="attr class">
        <a class="headerlink" href="#SequenceNumber">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">SequenceNumber</span>:
    </div>

    
            <div class="docstring"><p>int([x]) -> integer
int(x, base=10) -> integer</p>

<p>Convert a number or string to an integer, or return 0 if no arguments
are given.  If x is a number, return x.__int__().  For floating point
numbers, this truncates towards zero.</p>

<p>If x is not a number or if base is given, then x must be a string,
bytes, or bytearray instance representing an integer literal in the
given base.  The literal can be preceded by '+' or '-' and be surrounded
by whitespace.  The base defaults to 10.  Valid bases are 0 and 2-36.
Base 0 means to interpret the base from the string as an integer literal.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;0b100&#39;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">4</span>
</code></pre></div>
</div>


                            <div id="SequenceNumber.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SequenceNumber.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">SequenceNumber</span><span class="signature">()</span>
    </div>

    
    

                            </div>
                            <div id="SequenceNumber.conjugate" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SequenceNumber.conjugate">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">conjugate</span><span class="signature">(unknown)</span>:
    </div>

    
            <div class="docstring"><p>Returns self, the complex conjugate of any int.</p>
</div>


                            </div>
                            <div id="SequenceNumber.bit_length" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SequenceNumber.bit_length">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">bit_length</span><span class="signature">(self, /)</span>:
    </div>

    
            <div class="docstring"><p>Number of bits necessary to represent self in binary.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">bin</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
<span class="go">&#39;0b100101&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">37</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="go">6</span>
</code></pre></div>
</div>


                            </div>
                            <div id="SequenceNumber.bit_count" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SequenceNumber.bit_count">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">bit_count</span><span class="signature">(self, /)</span>:
    </div>

    
            <div class="docstring"><p>Number of ones in the binary representation of the absolute value of self.</p>

<p>Also known as the population count.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">bin</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="go">&#39;0b1101&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">bit_count</span><span class="p">()</span>
<span class="go">3</span>
</code></pre></div>
</div>


                            </div>
                            <div id="SequenceNumber.to_bytes" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SequenceNumber.to_bytes">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_bytes</span><span class="signature">(self, /, length, byteorder, *, signed=False)</span>:
    </div>

    
            <div class="docstring"><p>Return an array of bytes representing an integer.</p>

<p>length
  Length of bytes object to use.  An OverflowError is raised if the
  integer is not representable with the given number of bytes.
byteorder
  The byte order used to represent the integer.  If byteorder is 'big',
  the most significant byte is at the beginning of the byte array.  If
  byteorder is 'little', the most significant byte is at the end of the
  byte array.  To request the native byte order of the host system, use
  `sys.byteorder' as the byte order value.
signed
  Determines whether two's complement is used to represent the integer.
  If signed is False and a negative integer is given, an OverflowError
  is raised.</p>
</div>


                            </div>
                            <div id="SequenceNumber.from_bytes" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SequenceNumber.from_bytes">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">from_bytes</span><span class="signature">(type, /, bytes, byteorder, *, signed=False)</span>:
    </div>

    
            <div class="docstring"><p>Return the integer represented by the given array of bytes.</p>

<p>bytes
  Holds the array of bytes to convert.  The argument must either
  support the buffer protocol or be an iterable object producing bytes.
  Bytes and bytearray are examples of built-in objects that support the
  buffer protocol.
byteorder
  The byte order used to represent the integer.  If byteorder is 'big',
  the most significant byte is at the beginning of the byte array.  If
  byteorder is 'little', the most significant byte is at the end of the
  byte array.  To request the native byte order of the host system, use
  `sys.byteorder' as the byte order value.
signed
  Indicates whether two's complement is used to represent the integer.</p>
</div>


                            </div>
                            <div id="SequenceNumber.as_integer_ratio" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#SequenceNumber.as_integer_ratio">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">as_integer_ratio</span><span class="signature">(self, /)</span>:
    </div>

    
            <div class="docstring"><p>Return integer ratio.</p>

<p>Return a pair of integers, whose ratio is exactly equal to the original int
and with a positive denominator.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">as_integer_ratio</span><span class="p">()</span>
<span class="go">(10, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">as_integer_ratio</span><span class="p">()</span>
<span class="go">(-10, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">as_integer_ratio</span><span class="p">()</span>
<span class="go">(0, 1)</span>
</code></pre></div>
</div>


                            </div>
                            <div id="SequenceNumber.real" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#SequenceNumber.real">#&nbsp;&nbsp</a>

        <span class="name">real</span>
    </div>

    
            <div class="docstring"><p>the real part of a complex number</p>
</div>


                            </div>
                            <div id="SequenceNumber.imag" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#SequenceNumber.imag">#&nbsp;&nbsp</a>

        <span class="name">imag</span>
    </div>

    
            <div class="docstring"><p>the imaginary part of a complex number</p>
</div>


                            </div>
                            <div id="SequenceNumber.numerator" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#SequenceNumber.numerator">#&nbsp;&nbsp</a>

        <span class="name">numerator</span>
    </div>

    
            <div class="docstring"><p>the numerator of a rational number in lowest terms</p>
</div>


                            </div>
                            <div id="SequenceNumber.denominator" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#SequenceNumber.denominator">#&nbsp;&nbsp</a>

        <span class="name">denominator</span>
    </div>

    
            <div class="docstring"><p>the denominator of a rational number in lowest terms</p>
</div>


                            </div>
                </section>
                <section id="ConnectionCb">
                                <div class="attr variable"><a class="headerlink" href="#ConnectionCb">#&nbsp;&nbsp</a>

        <span class="name">ConnectionCb</span><span class="default_value"> = typing.Callable[[ForwardRef(&#39;Connection&#39;)], typing.Optional[typing.Awaitable[NoneType]]]</span>
    </div>

    
    

                </section>
                <section id="connect">
                            <div class="attr function"><a class="headerlink" href="#connect">#&nbsp;&nbsp</a>

        
            <span class="def">async def</span>
            <span class="name">connect</span><span class="signature">(
    addr: <a href="../tcp.html#Address">hat.drivers.tcp.Address</a>,
    response_timeout: float = 15,
    supervisory_timeout: float = 10,
    test_timeout: float = 20,
    send_window_size: int = 12,
    receive_window_size: int = 8
) -&gt; <a href="#Connection">hat.drivers.iec60870.apci.Connection</a></span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="connect-20"><a href="#connect-20"><span class="linenos">20</span></a><span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">addr</span><span class="p">:</span> <span class="n">tcp</span><span class="o">.</span><span class="n">Address</span><span class="p">,</span>
</span><span id="connect-21"><a href="#connect-21"><span class="linenos">21</span></a>                  <span class="n">response_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="connect-22"><a href="#connect-22"><span class="linenos">22</span></a>                  <span class="n">supervisory_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="connect-23"><a href="#connect-23"><span class="linenos">23</span></a>                  <span class="n">test_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="connect-24"><a href="#connect-24"><span class="linenos">24</span></a>                  <span class="n">send_window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
</span><span id="connect-25"><a href="#connect-25"><span class="linenos">25</span></a>                  <span class="n">receive_window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="connect-26"><a href="#connect-26"><span class="linenos">26</span></a>                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Connection&#39;</span><span class="p">:</span>
</span><span id="connect-27"><a href="#connect-27"><span class="linenos">27</span></a>    <span class="sd">&quot;&quot;&quot;Connect to remote device</span>
</span><span id="connect-28"><a href="#connect-28"><span class="linenos">28</span></a>
</span><span id="connect-29"><a href="#connect-29"><span class="linenos">29</span></a><span class="sd">    Args:</span>
</span><span id="connect-30"><a href="#connect-30"><span class="linenos">30</span></a><span class="sd">        addr: remote server&#39;s address</span>
</span><span id="connect-31"><a href="#connect-31"><span class="linenos">31</span></a><span class="sd">        response_timeout: response timeout (t1) in seconds</span>
</span><span id="connect-32"><a href="#connect-32"><span class="linenos">32</span></a><span class="sd">        supervisory_timeout: supervisory timeout (t2) in seconds</span>
</span><span id="connect-33"><a href="#connect-33"><span class="linenos">33</span></a><span class="sd">        test_timeout: test timeout (t3) in seconds</span>
</span><span id="connect-34"><a href="#connect-34"><span class="linenos">34</span></a><span class="sd">        send_window_size: send window size (k)</span>
</span><span id="connect-35"><a href="#connect-35"><span class="linenos">35</span></a><span class="sd">        receive_window_size: receive window size (w)</span>
</span><span id="connect-36"><a href="#connect-36"><span class="linenos">36</span></a>
</span><span id="connect-37"><a href="#connect-37"><span class="linenos">37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="connect-38"><a href="#connect-38"><span class="linenos">38</span></a>    <span class="n">conn</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tcp</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
</span><span id="connect-39"><a href="#connect-39"><span class="linenos">39</span></a>
</span><span id="connect-40"><a href="#connect-40"><span class="linenos">40</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="connect-41"><a href="#connect-41"><span class="linenos">41</span></a>        <span class="n">_write_apdu</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUU</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">STARTDT_ACT</span><span class="p">))</span>
</span><span id="connect-42"><a href="#connect-42"><span class="linenos">42</span></a>        <span class="k">await</span> <span class="n">aio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">_wait_startdt_con</span><span class="p">(</span><span class="n">conn</span><span class="p">),</span> <span class="n">response_timeout</span><span class="p">)</span>
</span><span id="connect-43"><a href="#connect-43"><span class="linenos">43</span></a>
</span><span id="connect-44"><a href="#connect-44"><span class="linenos">44</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="connect-45"><a href="#connect-45"><span class="linenos">45</span></a>        <span class="k">await</span> <span class="n">aio</span><span class="o">.</span><span class="n">uncancellable</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">async_close</span><span class="p">())</span>
</span><span id="connect-46"><a href="#connect-46"><span class="linenos">46</span></a>        <span class="k">raise</span>
</span><span id="connect-47"><a href="#connect-47"><span class="linenos">47</span></a>
</span><span id="connect-48"><a href="#connect-48"><span class="linenos">48</span></a>    <span class="k">return</span> <span class="n">Connection</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span>
</span><span id="connect-49"><a href="#connect-49"><span class="linenos">49</span></a>                      <span class="n">always_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="connect-50"><a href="#connect-50"><span class="linenos">50</span></a>                      <span class="n">response_timeout</span><span class="o">=</span><span class="n">response_timeout</span><span class="p">,</span>
</span><span id="connect-51"><a href="#connect-51"><span class="linenos">51</span></a>                      <span class="n">supervisory_timeout</span><span class="o">=</span><span class="n">supervisory_timeout</span><span class="p">,</span>
</span><span id="connect-52"><a href="#connect-52"><span class="linenos">52</span></a>                      <span class="n">test_timeout</span><span class="o">=</span><span class="n">test_timeout</span><span class="p">,</span>
</span><span id="connect-53"><a href="#connect-53"><span class="linenos">53</span></a>                      <span class="n">send_window_size</span><span class="o">=</span><span class="n">send_window_size</span><span class="p">,</span>
</span><span id="connect-54"><a href="#connect-54"><span class="linenos">54</span></a>                      <span class="n">receive_window_size</span><span class="o">=</span><span class="n">receive_window_size</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Connect to remote device</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>addr:</strong>  remote server's address</li>
<li><strong>response_timeout:</strong>  response timeout (t1) in seconds</li>
<li><strong>supervisory_timeout:</strong>  supervisory timeout (t2) in seconds</li>
<li><strong>test_timeout:</strong>  test timeout (t3) in seconds</li>
<li><strong>send_window_size:</strong>  send window size (k)</li>
<li><strong>receive_window_size:</strong>  receive window size (w)</li>
</ul>
</div>


                </section>
                <section id="listen">
                            <div class="attr function"><a class="headerlink" href="#listen">#&nbsp;&nbsp</a>

        
            <span class="def">async def</span>
            <span class="name">listen</span><span class="signature">(
    connection_cb: Callable[[<a href="#Connection">hat.drivers.iec60870.apci.Connection</a>], Optional[Awaitable[NoneType]]],
    addr: <a href="../tcp.html#Address">hat.drivers.tcp.Address</a> = Address(host=&#39;0.0.0.0&#39;, port=2404),
    response_timeout: float = 15,
    supervisory_timeout: float = 10,
    test_timeout: float = 20,
    send_window_size: int = 12,
    receive_window_size: int = 8
) -&gt; <a href="#Server">hat.drivers.iec60870.apci.Server</a></span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="listen-57"><a href="#listen-57"><span class="linenos">57</span></a><span class="k">async</span> <span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="n">connection_cb</span><span class="p">:</span> <span class="n">ConnectionCb</span><span class="p">,</span>
</span><span id="listen-58"><a href="#listen-58"><span class="linenos">58</span></a>                 <span class="n">addr</span><span class="p">:</span> <span class="n">tcp</span><span class="o">.</span><span class="n">Address</span> <span class="o">=</span> <span class="n">tcp</span><span class="o">.</span><span class="n">Address</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">2404</span><span class="p">),</span>
</span><span id="listen-59"><a href="#listen-59"><span class="linenos">59</span></a>                 <span class="n">response_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="listen-60"><a href="#listen-60"><span class="linenos">60</span></a>                 <span class="n">supervisory_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="listen-61"><a href="#listen-61"><span class="linenos">61</span></a>                 <span class="n">test_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="listen-62"><a href="#listen-62"><span class="linenos">62</span></a>                 <span class="n">send_window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
</span><span id="listen-63"><a href="#listen-63"><span class="linenos">63</span></a>                 <span class="n">receive_window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="listen-64"><a href="#listen-64"><span class="linenos">64</span></a>                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Server&#39;</span><span class="p">:</span>
</span><span id="listen-65"><a href="#listen-65"><span class="linenos">65</span></a>    <span class="sd">&quot;&quot;&quot;Create new IEC104 slave and listen for incoming connections</span>
</span><span id="listen-66"><a href="#listen-66"><span class="linenos">66</span></a>
</span><span id="listen-67"><a href="#listen-67"><span class="linenos">67</span></a><span class="sd">    Args:</span>
</span><span id="listen-68"><a href="#listen-68"><span class="linenos">68</span></a><span class="sd">        connection_cb: new connection callback</span>
</span><span id="listen-69"><a href="#listen-69"><span class="linenos">69</span></a><span class="sd">        addr: listening socket address</span>
</span><span id="listen-70"><a href="#listen-70"><span class="linenos">70</span></a><span class="sd">        response_timeout: response timeout (t1) in seconds</span>
</span><span id="listen-71"><a href="#listen-71"><span class="linenos">71</span></a><span class="sd">        supervisory_timeout: supervisory timeout (t2) in seconds</span>
</span><span id="listen-72"><a href="#listen-72"><span class="linenos">72</span></a><span class="sd">        test_timeout: test timeout (t3) in seconds</span>
</span><span id="listen-73"><a href="#listen-73"><span class="linenos">73</span></a><span class="sd">        send_window_size: send window size (k)</span>
</span><span id="listen-74"><a href="#listen-74"><span class="linenos">74</span></a><span class="sd">        receive_window_size: receive window size (w)</span>
</span><span id="listen-75"><a href="#listen-75"><span class="linenos">75</span></a>
</span><span id="listen-76"><a href="#listen-76"><span class="linenos">76</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="listen-77"><a href="#listen-77"><span class="linenos">77</span></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">()</span>
</span><span id="listen-78"><a href="#listen-78"><span class="linenos">78</span></a>    <span class="n">server</span><span class="o">.</span><span class="n">_connection_cb</span> <span class="o">=</span> <span class="n">connection_cb</span>
</span><span id="listen-79"><a href="#listen-79"><span class="linenos">79</span></a>    <span class="n">server</span><span class="o">.</span><span class="n">_response_timeout</span> <span class="o">=</span> <span class="n">response_timeout</span>
</span><span id="listen-80"><a href="#listen-80"><span class="linenos">80</span></a>    <span class="n">server</span><span class="o">.</span><span class="n">_supervisory_timeout</span> <span class="o">=</span> <span class="n">supervisory_timeout</span>
</span><span id="listen-81"><a href="#listen-81"><span class="linenos">81</span></a>    <span class="n">server</span><span class="o">.</span><span class="n">_test_timeout</span> <span class="o">=</span> <span class="n">test_timeout</span>
</span><span id="listen-82"><a href="#listen-82"><span class="linenos">82</span></a>    <span class="n">server</span><span class="o">.</span><span class="n">_send_window_size</span> <span class="o">=</span> <span class="n">send_window_size</span>
</span><span id="listen-83"><a href="#listen-83"><span class="linenos">83</span></a>    <span class="n">server</span><span class="o">.</span><span class="n">_receive_window_size</span> <span class="o">=</span> <span class="n">receive_window_size</span>
</span><span id="listen-84"><a href="#listen-84"><span class="linenos">84</span></a>
</span><span id="listen-85"><a href="#listen-85"><span class="linenos">85</span></a>    <span class="n">server</span><span class="o">.</span><span class="n">_srv</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tcp</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">_on_connection</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span>
</span><span id="listen-86"><a href="#listen-86"><span class="linenos">86</span></a>                                   <span class="n">bind_connections</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="listen-87"><a href="#listen-87"><span class="linenos">87</span></a>
</span><span id="listen-88"><a href="#listen-88"><span class="linenos">88</span></a>    <span class="k">return</span> <span class="n">server</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Create new IEC104 slave and listen for incoming connections</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>connection_cb:</strong>  new connection callback</li>
<li><strong>addr:</strong>  listening socket address</li>
<li><strong>response_timeout:</strong>  response timeout (t1) in seconds</li>
<li><strong>supervisory_timeout:</strong>  supervisory timeout (t2) in seconds</li>
<li><strong>test_timeout:</strong>  test timeout (t3) in seconds</li>
<li><strong>send_window_size:</strong>  send window size (k)</li>
<li><strong>receive_window_size:</strong>  receive window size (w)</li>
</ul>
</div>


                </section>
                <section id="Server">
                                <div class="attr class">
        <a class="headerlink" href="#Server">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Server</span><wbr>(<span class="base">hat.aio.Resource</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Server-91"><a href="#Server-91"><span class="linenos"> 91</span></a><span class="k">class</span> <span class="nc">Server</span><span class="p">(</span><span class="n">aio</span><span class="o">.</span><span class="n">Resource</span><span class="p">):</span>
</span><span id="Server-92"><a href="#Server-92"><span class="linenos"> 92</span></a>    <span class="sd">&quot;&quot;&quot;Server</span>
</span><span id="Server-93"><a href="#Server-93"><span class="linenos"> 93</span></a>
</span><span id="Server-94"><a href="#Server-94"><span class="linenos"> 94</span></a><span class="sd">    For creating new Server instances see `listen` coroutine.</span>
</span><span id="Server-95"><a href="#Server-95"><span class="linenos"> 95</span></a>
</span><span id="Server-96"><a href="#Server-96"><span class="linenos"> 96</span></a><span class="sd">    Closing server closes all incoming connections.</span>
</span><span id="Server-97"><a href="#Server-97"><span class="linenos"> 97</span></a>
</span><span id="Server-98"><a href="#Server-98"><span class="linenos"> 98</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Server-99"><a href="#Server-99"><span class="linenos"> 99</span></a>
</span><span id="Server-100"><a href="#Server-100"><span class="linenos">100</span></a>    <span class="nd">@property</span>
</span><span id="Server-101"><a href="#Server-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">async_group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">aio</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
</span><span id="Server-102"><a href="#Server-102"><span class="linenos">102</span></a>        <span class="sd">&quot;&quot;&quot;Async group&quot;&quot;&quot;</span>
</span><span id="Server-103"><a href="#Server-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_srv</span><span class="o">.</span><span class="n">async_group</span>
</span><span id="Server-104"><a href="#Server-104"><span class="linenos">104</span></a>
</span><span id="Server-105"><a href="#Server-105"><span class="linenos">105</span></a>    <span class="nd">@property</span>
</span><span id="Server-106"><a href="#Server-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">tcp</span><span class="o">.</span><span class="n">Address</span><span class="p">]:</span>
</span><span id="Server-107"><a href="#Server-107"><span class="linenos">107</span></a>        <span class="sd">&quot;&quot;&quot;Listening addresses&quot;&quot;&quot;</span>
</span><span id="Server-108"><a href="#Server-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_srv</span><span class="o">.</span><span class="n">addresses</span>
</span><span id="Server-109"><a href="#Server-109"><span class="linenos">109</span></a>
</span><span id="Server-110"><a href="#Server-110"><span class="linenos">110</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_on_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
</span><span id="Server-111"><a href="#Server-111"><span class="linenos">111</span></a>        <span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span>
</span><span id="Server-112"><a href="#Server-112"><span class="linenos">112</span></a>                                <span class="n">always_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Server-113"><a href="#Server-113"><span class="linenos">113</span></a>                                <span class="n">response_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_response_timeout</span><span class="p">,</span>
</span><span id="Server-114"><a href="#Server-114"><span class="linenos">114</span></a>                                <span class="n">supervisory_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_timeout</span><span class="p">,</span>
</span><span id="Server-115"><a href="#Server-115"><span class="linenos">115</span></a>                                <span class="n">test_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_timeout</span><span class="p">,</span>
</span><span id="Server-116"><a href="#Server-116"><span class="linenos">116</span></a>                                <span class="n">send_window_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_window_size</span><span class="p">,</span>
</span><span id="Server-117"><a href="#Server-117"><span class="linenos">117</span></a>                                <span class="n">receive_window_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_receive_window_size</span><span class="p">)</span>
</span><span id="Server-118"><a href="#Server-118"><span class="linenos">118</span></a>
</span><span id="Server-119"><a href="#Server-119"><span class="linenos">119</span></a>        <span class="k">await</span> <span class="n">aio</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_cb</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Server</p>

<p>For creating new Server instances see <code><a href="#listen">listen</a></code> coroutine.</p>

<p>Closing server closes all incoming connections.</p>
</div>


                            <div id="Server.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Server.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Server</span><span class="signature">()</span>
    </div>

    
    

                            </div>
                            <div id="Server.async_group" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Server.async_group">#&nbsp;&nbsp</a>

        <span class="name">async_group</span><span class="annotation">: hat.aio.Group</span>
    </div>

    
            <div class="docstring"><p>Async group</p>
</div>


                            </div>
                            <div id="Server.addresses" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Server.addresses">#&nbsp;&nbsp</a>

        <span class="name">addresses</span><span class="annotation">: List[<a href="../tcp.html#Address">hat.drivers.tcp.Address</a>]</span>
    </div>

    
            <div class="docstring"><p>Listening addresses</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>hat.aio.Resource</dt>
                                <dd id="Server.is_open" class="variable">is_open</dd>
                <dd id="Server.is_closing" class="variable">is_closing</dd>
                <dd id="Server.is_closed" class="variable">is_closed</dd>
                <dd id="Server.wait_closing" class="function">wait_closing</dd>
                <dd id="Server.wait_closed" class="function">wait_closed</dd>
                <dd id="Server.close" class="function">close</dd>
                <dd id="Server.async_close" class="function">async_close</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Connection">
                                <div class="attr class">
        <a class="headerlink" href="#Connection">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Connection</span><wbr>(<span class="base">hat.aio.Resource</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Connection-122"><a href="#Connection-122"><span class="linenos">122</span></a><span class="k">class</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">aio</span><span class="o">.</span><span class="n">Resource</span><span class="p">):</span>
</span><span id="Connection-123"><a href="#Connection-123"><span class="linenos">123</span></a>
</span><span id="Connection-124"><a href="#Connection-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Connection-125"><a href="#Connection-125"><span class="linenos">125</span></a>                 <span class="n">conn</span><span class="p">:</span> <span class="n">tcp</span><span class="o">.</span><span class="n">Connection</span><span class="p">,</span>
</span><span id="Connection-126"><a href="#Connection-126"><span class="linenos">126</span></a>                 <span class="n">always_enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="Connection-127"><a href="#Connection-127"><span class="linenos">127</span></a>                 <span class="n">response_timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Connection-128"><a href="#Connection-128"><span class="linenos">128</span></a>                 <span class="n">supervisory_timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Connection-129"><a href="#Connection-129"><span class="linenos">129</span></a>                 <span class="n">test_timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Connection-130"><a href="#Connection-130"><span class="linenos">130</span></a>                 <span class="n">send_window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Connection-131"><a href="#Connection-131"><span class="linenos">131</span></a>                 <span class="n">receive_window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Connection-132"><a href="#Connection-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="n">conn</span>
</span><span id="Connection-133"><a href="#Connection-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_always_enabled</span> <span class="o">=</span> <span class="n">always_enabled</span>
</span><span id="Connection-134"><a href="#Connection-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_enabled</span> <span class="o">=</span> <span class="n">always_enabled</span>
</span><span id="Connection-135"><a href="#Connection-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_response_timeout</span> <span class="o">=</span> <span class="n">response_timeout</span>
</span><span id="Connection-136"><a href="#Connection-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_timeout</span> <span class="o">=</span> <span class="n">supervisory_timeout</span>
</span><span id="Connection-137"><a href="#Connection-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_test_timeout</span> <span class="o">=</span> <span class="n">test_timeout</span>
</span><span id="Connection-138"><a href="#Connection-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_send_window_size</span> <span class="o">=</span> <span class="n">send_window_size</span>
</span><span id="Connection-139"><a href="#Connection-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_window_size</span> <span class="o">=</span> <span class="n">receive_window_size</span>
</span><span id="Connection-140"><a href="#Connection-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_queue</span> <span class="o">=</span> <span class="n">aio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="Connection-141"><a href="#Connection-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span> <span class="o">=</span> <span class="n">aio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="Connection-142"><a href="#Connection-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_test_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="Connection-143"><a href="#Connection-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ssn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-144"><a href="#Connection-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-145"><a href="#Connection-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ack</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-146"><a href="#Connection-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-147"><a href="#Connection-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Connection-148"><a href="#Connection-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_handles</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Connection-149"><a href="#Connection-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_cv</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>
</span><span id="Connection-150"><a href="#Connection-150"><span class="linenos">150</span></a>
</span><span id="Connection-151"><a href="#Connection-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">async_group</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_loop</span><span class="p">)</span>
</span><span id="Connection-152"><a href="#Connection-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">async_group</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_loop</span><span class="p">)</span>
</span><span id="Connection-153"><a href="#Connection-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">async_group</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_loop</span><span class="p">)</span>
</span><span id="Connection-154"><a href="#Connection-154"><span class="linenos">154</span></a>
</span><span id="Connection-155"><a href="#Connection-155"><span class="linenos">155</span></a>    <span class="nd">@property</span>
</span><span id="Connection-156"><a href="#Connection-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">async_group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">aio</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
</span><span id="Connection-157"><a href="#Connection-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">async_group</span>
</span><span id="Connection-158"><a href="#Connection-158"><span class="linenos">158</span></a>
</span><span id="Connection-159"><a href="#Connection-159"><span class="linenos">159</span></a>    <span class="nd">@property</span>
</span><span id="Connection-160"><a href="#Connection-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tcp</span><span class="o">.</span><span class="n">ConnectionInfo</span><span class="p">:</span>
</span><span id="Connection-161"><a href="#Connection-161"><span class="linenos">161</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">info</span>
</span><span id="Connection-162"><a href="#Connection-162"><span class="linenos">162</span></a>
</span><span id="Connection-163"><a href="#Connection-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">common</span><span class="o">.</span><span class="n">Bytes</span><span class="p">):</span>
</span><span id="Connection-164"><a href="#Connection-164"><span class="linenos">164</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection-165"><a href="#Connection-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Connection-166"><a href="#Connection-166"><span class="linenos">166</span></a>
</span><span id="Connection-167"><a href="#Connection-167"><span class="linenos">167</span></a>        <span class="k">except</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">:</span>
</span><span id="Connection-168"><a href="#Connection-168"><span class="linenos">168</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">()</span>
</span><span id="Connection-169"><a href="#Connection-169"><span class="linenos">169</span></a>
</span><span id="Connection-170"><a href="#Connection-170"><span class="linenos">170</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">drain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-171"><a href="#Connection-171"><span class="linenos">171</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection-172"><a href="#Connection-172"><span class="linenos">172</span></a>            <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>
</span><span id="Connection-173"><a href="#Connection-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span><span id="Connection-174"><a href="#Connection-174"><span class="linenos">174</span></a>            <span class="k">await</span> <span class="n">future</span>
</span><span id="Connection-175"><a href="#Connection-175"><span class="linenos">175</span></a>
</span><span id="Connection-176"><a href="#Connection-176"><span class="linenos">176</span></a>        <span class="k">except</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">:</span>
</span><span id="Connection-177"><a href="#Connection-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">()</span>
</span><span id="Connection-178"><a href="#Connection-178"><span class="linenos">178</span></a>
</span><span id="Connection-179"><a href="#Connection-179"><span class="linenos">179</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>
</span><span id="Connection-180"><a href="#Connection-180"><span class="linenos">180</span></a>
</span><span id="Connection-181"><a href="#Connection-181"><span class="linenos">181</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">common</span><span class="o">.</span><span class="n">Bytes</span><span class="p">:</span>
</span><span id="Connection-182"><a href="#Connection-182"><span class="linenos">182</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection-183"><a href="#Connection-183"><span class="linenos">183</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Connection-184"><a href="#Connection-184"><span class="linenos">184</span></a>
</span><span id="Connection-185"><a href="#Connection-185"><span class="linenos">185</span></a>        <span class="k">except</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">:</span>
</span><span id="Connection-186"><a href="#Connection-186"><span class="linenos">186</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">()</span>
</span><span id="Connection-187"><a href="#Connection-187"><span class="linenos">187</span></a>
</span><span id="Connection-188"><a href="#Connection-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="nf">_on_response_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-189"><a href="#Connection-189"><span class="linenos">189</span></a>        <span class="n">mlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;response timeout occured - closing connection&quot;</span><span class="p">)</span>
</span><span id="Connection-190"><a href="#Connection-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Connection-191"><a href="#Connection-191"><span class="linenos">191</span></a>
</span><span id="Connection-192"><a href="#Connection-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">_on_supervisory_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-193"><a href="#Connection-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Connection-194"><a href="#Connection-194"><span class="linenos">194</span></a>
</span><span id="Connection-195"><a href="#Connection-195"><span class="linenos">195</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection-196"><a href="#Connection-196"><span class="linenos">196</span></a>            <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span><span class="p">))</span>
</span><span id="Connection-197"><a href="#Connection-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-198"><a href="#Connection-198"><span class="linenos">198</span></a>
</span><span id="Connection-199"><a href="#Connection-199"><span class="linenos">199</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Connection-200"><a href="#Connection-200"><span class="linenos">200</span></a>            <span class="n">mlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;supervisory timeout error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
</span><span id="Connection-201"><a href="#Connection-201"><span class="linenos">201</span></a>
</span><span id="Connection-202"><a href="#Connection-202"><span class="linenos">202</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_read_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-203"><a href="#Connection-203"><span class="linenos">203</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection-204"><a href="#Connection-204"><span class="linenos">204</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Connection-205"><a href="#Connection-205"><span class="linenos">205</span></a>                <span class="n">apdu</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_read_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">)</span>
</span><span id="Connection-206"><a href="#Connection-206"><span class="linenos">206</span></a>
</span><span id="Connection-207"><a href="#Connection-207"><span class="linenos">207</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">apdu</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUU</span><span class="p">):</span>
</span><span id="Connection-208"><a href="#Connection-208"><span class="linenos">208</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_apduu</span><span class="p">(</span><span class="n">apdu</span><span class="p">)</span>
</span><span id="Connection-209"><a href="#Connection-209"><span class="linenos">209</span></a>
</span><span id="Connection-210"><a href="#Connection-210"><span class="linenos">210</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">apdu</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUS</span><span class="p">):</span>
</span><span id="Connection-211"><a href="#Connection-211"><span class="linenos">211</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_apdus</span><span class="p">(</span><span class="n">apdu</span><span class="p">)</span>
</span><span id="Connection-212"><a href="#Connection-212"><span class="linenos">212</span></a>
</span><span id="Connection-213"><a href="#Connection-213"><span class="linenos">213</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">apdu</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUI</span><span class="p">):</span>
</span><span id="Connection-214"><a href="#Connection-214"><span class="linenos">214</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_apdui</span><span class="p">(</span><span class="n">apdu</span><span class="p">)</span>
</span><span id="Connection-215"><a href="#Connection-215"><span class="linenos">215</span></a>
</span><span id="Connection-216"><a href="#Connection-216"><span class="linenos">216</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Connection-217"><a href="#Connection-217"><span class="linenos">217</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unsupported APDU&quot;</span><span class="p">)</span>
</span><span id="Connection-218"><a href="#Connection-218"><span class="linenos">218</span></a>
</span><span id="Connection-219"><a href="#Connection-219"><span class="linenos">219</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">):</span>
</span><span id="Connection-220"><a href="#Connection-220"><span class="linenos">220</span></a>            <span class="k">pass</span>
</span><span id="Connection-221"><a href="#Connection-221"><span class="linenos">221</span></a>
</span><span id="Connection-222"><a href="#Connection-222"><span class="linenos">222</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Connection-223"><a href="#Connection-223"><span class="linenos">223</span></a>            <span class="n">mlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;read loop error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
</span><span id="Connection-224"><a href="#Connection-224"><span class="linenos">224</span></a>
</span><span id="Connection-225"><a href="#Connection-225"><span class="linenos">225</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="Connection-226"><a href="#Connection-226"><span class="linenos">226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Connection-227"><a href="#Connection-227"><span class="linenos">227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_receive_queue</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Connection-228"><a href="#Connection-228"><span class="linenos">228</span></a>
</span><span id="Connection-229"><a href="#Connection-229"><span class="linenos">229</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_write_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-230"><a href="#Connection-230"><span class="linenos">230</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection-231"><a href="#Connection-231"><span class="linenos">231</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Connection-232"><a href="#Connection-232"><span class="linenos">232</span></a>                <span class="n">asdu</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Connection-233"><a href="#Connection-233"><span class="linenos">233</span></a>
</span><span id="Connection-234"><a href="#Connection-234"><span class="linenos">234</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">asdu</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">):</span>
</span><span id="Connection-235"><a href="#Connection-235"><span class="linenos">235</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">asdu</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
</span><span id="Connection-236"><a href="#Connection-236"><span class="linenos">236</span></a>                        <span class="n">asdu</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Connection-237"><a href="#Connection-237"><span class="linenos">237</span></a>                    <span class="k">continue</span>
</span><span id="Connection-238"><a href="#Connection-238"><span class="linenos">238</span></a>
</span><span id="Connection-239"><a href="#Connection-239"><span class="linenos">239</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_handles</span><span class="p">:</span>
</span><span id="Connection-240"><a href="#Connection-240"><span class="linenos">240</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;can not reuse already registered ssn&quot;</span><span class="p">)</span>
</span><span id="Connection-241"><a href="#Connection-241"><span class="linenos">241</span></a>
</span><span id="Connection-242"><a href="#Connection-242"><span class="linenos">242</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_cv</span><span class="p">:</span>
</span><span id="Connection-243"><a href="#Connection-243"><span class="linenos">243</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_cv</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
</span><span id="Connection-244"><a href="#Connection-244"><span class="linenos">244</span></a>                        <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_handles</span><span class="p">)</span> <span class="o">&lt;</span>
</span><span id="Connection-245"><a href="#Connection-245"><span class="linenos">245</span></a>                                 <span class="bp">self</span><span class="o">.</span><span class="n">_send_window_size</span><span class="p">))</span>
</span><span id="Connection-246"><a href="#Connection-246"><span class="linenos">246</span></a>
</span><span id="Connection-247"><a href="#Connection-247"><span class="linenos">247</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_enabled</span><span class="p">:</span>
</span><span id="Connection-248"><a href="#Connection-248"><span class="linenos">248</span></a>                    <span class="n">mlog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;send data not enabled - discarding message&quot;</span><span class="p">)</span>
</span><span id="Connection-249"><a href="#Connection-249"><span class="linenos">249</span></a>                    <span class="k">continue</span>
</span><span id="Connection-250"><a href="#Connection-250"><span class="linenos">250</span></a>
</span><span id="Connection-251"><a href="#Connection-251"><span class="linenos">251</span></a>                <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUI</span><span class="p">(</span><span class="n">ssn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ssn</span><span class="p">,</span>
</span><span id="Connection-252"><a href="#Connection-252"><span class="linenos">252</span></a>                                                     <span class="n">rsn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span><span class="p">,</span>
</span><span id="Connection-253"><a href="#Connection-253"><span class="linenos">253</span></a>                                                     <span class="n">data</span><span class="o">=</span><span class="n">asdu</span><span class="p">))</span>
</span><span id="Connection-254"><a href="#Connection-254"><span class="linenos">254</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-255"><a href="#Connection-255"><span class="linenos">255</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_stop_supervisory_timeout</span><span class="p">()</span>
</span><span id="Connection-256"><a href="#Connection-256"><span class="linenos">256</span></a>
</span><span id="Connection-257"><a href="#Connection-257"><span class="linenos">257</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_handles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ssn</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Connection-258"><a href="#Connection-258"><span class="linenos">258</span></a>                    <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span>
</span><span id="Connection-259"><a href="#Connection-259"><span class="linenos">259</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_response_timeout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_response_timeout</span><span class="p">))</span>
</span><span id="Connection-260"><a href="#Connection-260"><span class="linenos">260</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ssn</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ssn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x8000</span>
</span><span id="Connection-261"><a href="#Connection-261"><span class="linenos">261</span></a>
</span><span id="Connection-262"><a href="#Connection-262"><span class="linenos">262</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">):</span>
</span><span id="Connection-263"><a href="#Connection-263"><span class="linenos">263</span></a>            <span class="k">pass</span>
</span><span id="Connection-264"><a href="#Connection-264"><span class="linenos">264</span></a>
</span><span id="Connection-265"><a href="#Connection-265"><span class="linenos">265</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Connection-266"><a href="#Connection-266"><span class="linenos">266</span></a>            <span class="n">mlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;write loop error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
</span><span id="Connection-267"><a href="#Connection-267"><span class="linenos">267</span></a>
</span><span id="Connection-268"><a href="#Connection-268"><span class="linenos">268</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="Connection-269"><a href="#Connection-269"><span class="linenos">269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Connection-270"><a href="#Connection-270"><span class="linenos">270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_supervisory_timeout</span><span class="p">()</span>
</span><span id="Connection-271"><a href="#Connection-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Connection-272"><a href="#Connection-272"><span class="linenos">272</span></a>
</span><span id="Connection-273"><a href="#Connection-273"><span class="linenos">273</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_handles</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="Connection-274"><a href="#Connection-274"><span class="linenos">274</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="Connection-275"><a href="#Connection-275"><span class="linenos">275</span></a>
</span><span id="Connection-276"><a href="#Connection-276"><span class="linenos">276</span></a>            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span><span id="Connection-277"><a href="#Connection-277"><span class="linenos">277</span></a>                <span class="n">asdu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
</span><span id="Connection-278"><a href="#Connection-278"><span class="linenos">278</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">asdu</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">asdu</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
</span><span id="Connection-279"><a href="#Connection-279"><span class="linenos">279</span></a>                    <span class="n">asdu</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="ne">ConnectionError</span><span class="p">())</span>
</span><span id="Connection-280"><a href="#Connection-280"><span class="linenos">280</span></a>
</span><span id="Connection-281"><a href="#Connection-281"><span class="linenos">281</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_test_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-282"><a href="#Connection-282"><span class="linenos">282</span></a>        <span class="c1"># TODO: implement reset timeout on received frame</span>
</span><span id="Connection-283"><a href="#Connection-283"><span class="linenos">283</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection-284"><a href="#Connection-284"><span class="linenos">284</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Connection-285"><a href="#Connection-285"><span class="linenos">285</span></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_timeout</span><span class="p">)</span>
</span><span id="Connection-286"><a href="#Connection-286"><span class="linenos">286</span></a>
</span><span id="Connection-287"><a href="#Connection-287"><span class="linenos">287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_test_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="Connection-288"><a href="#Connection-288"><span class="linenos">288</span></a>                <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span>
</span><span id="Connection-289"><a href="#Connection-289"><span class="linenos">289</span></a>                            <span class="n">common</span><span class="o">.</span><span class="n">APDUU</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">TESTFR_ACT</span><span class="p">))</span>
</span><span id="Connection-290"><a href="#Connection-290"><span class="linenos">290</span></a>
</span><span id="Connection-291"><a href="#Connection-291"><span class="linenos">291</span></a>                <span class="k">await</span> <span class="n">aio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(),</span>
</span><span id="Connection-292"><a href="#Connection-292"><span class="linenos">292</span></a>                                   <span class="bp">self</span><span class="o">.</span><span class="n">_response_timeout</span><span class="p">)</span>
</span><span id="Connection-293"><a href="#Connection-293"><span class="linenos">293</span></a>
</span><span id="Connection-294"><a href="#Connection-294"><span class="linenos">294</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Connection-295"><a href="#Connection-295"><span class="linenos">295</span></a>            <span class="n">mlog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;test loop error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
</span><span id="Connection-296"><a href="#Connection-296"><span class="linenos">296</span></a>
</span><span id="Connection-297"><a href="#Connection-297"><span class="linenos">297</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="Connection-298"><a href="#Connection-298"><span class="linenos">298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Connection-299"><a href="#Connection-299"><span class="linenos">299</span></a>
</span><span id="Connection-300"><a href="#Connection-300"><span class="linenos">300</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_process_apduu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apdu</span><span class="p">):</span>
</span><span id="Connection-301"><a href="#Connection-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="n">apdu</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">STARTDT_ACT</span><span class="p">:</span>
</span><span id="Connection-302"><a href="#Connection-302"><span class="linenos">302</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_is_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Connection-303"><a href="#Connection-303"><span class="linenos">303</span></a>            <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span>
</span><span id="Connection-304"><a href="#Connection-304"><span class="linenos">304</span></a>                        <span class="n">common</span><span class="o">.</span><span class="n">APDUU</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">STARTDT_CON</span><span class="p">))</span>
</span><span id="Connection-305"><a href="#Connection-305"><span class="linenos">305</span></a>
</span><span id="Connection-306"><a href="#Connection-306"><span class="linenos">306</span></a>        <span class="k">elif</span> <span class="n">apdu</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">STOPDT_ACT</span><span class="p">:</span>
</span><span id="Connection-307"><a href="#Connection-307"><span class="linenos">307</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_always_enabled</span><span class="p">:</span>
</span><span id="Connection-308"><a href="#Connection-308"><span class="linenos">308</span></a>                <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span><span class="p">))</span>
</span><span id="Connection-309"><a href="#Connection-309"><span class="linenos">309</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-310"><a href="#Connection-310"><span class="linenos">310</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_stop_supervisory_timeout</span><span class="p">()</span>
</span><span id="Connection-311"><a href="#Connection-311"><span class="linenos">311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_is_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Connection-312"><a href="#Connection-312"><span class="linenos">312</span></a>                <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span>
</span><span id="Connection-313"><a href="#Connection-313"><span class="linenos">313</span></a>                            <span class="n">common</span><span class="o">.</span><span class="n">APDUU</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">STOPDT_CON</span><span class="p">))</span>
</span><span id="Connection-314"><a href="#Connection-314"><span class="linenos">314</span></a>
</span><span id="Connection-315"><a href="#Connection-315"><span class="linenos">315</span></a>        <span class="k">elif</span> <span class="n">apdu</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">TESTFR_ACT</span><span class="p">:</span>
</span><span id="Connection-316"><a href="#Connection-316"><span class="linenos">316</span></a>            <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span>
</span><span id="Connection-317"><a href="#Connection-317"><span class="linenos">317</span></a>                        <span class="n">common</span><span class="o">.</span><span class="n">APDUU</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">TESTFR_CON</span><span class="p">))</span>
</span><span id="Connection-318"><a href="#Connection-318"><span class="linenos">318</span></a>
</span><span id="Connection-319"><a href="#Connection-319"><span class="linenos">319</span></a>        <span class="k">elif</span> <span class="n">apdu</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="n">common</span><span class="o">.</span><span class="n">ApduFunction</span><span class="o">.</span><span class="n">TESTFR_CON</span><span class="p">:</span>
</span><span id="Connection-320"><a href="#Connection-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_test_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="Connection-321"><a href="#Connection-321"><span class="linenos">321</span></a>
</span><span id="Connection-322"><a href="#Connection-322"><span class="linenos">322</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_process_apdus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apdu</span><span class="p">):</span>
</span><span id="Connection-323"><a href="#Connection-323"><span class="linenos">323</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_ack</span><span class="p">(</span><span class="n">apdu</span><span class="o">.</span><span class="n">rsn</span><span class="p">)</span>
</span><span id="Connection-324"><a href="#Connection-324"><span class="linenos">324</span></a>
</span><span id="Connection-325"><a href="#Connection-325"><span class="linenos">325</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_process_apdui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apdu</span><span class="p">):</span>
</span><span id="Connection-326"><a href="#Connection-326"><span class="linenos">326</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_ack</span><span class="p">(</span><span class="n">apdu</span><span class="o">.</span><span class="n">rsn</span><span class="p">)</span>
</span><span id="Connection-327"><a href="#Connection-327"><span class="linenos">327</span></a>
</span><span id="Connection-328"><a href="#Connection-328"><span class="linenos">328</span></a>        <span class="k">if</span> <span class="n">apdu</span><span class="o">.</span><span class="n">ssn</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span><span class="p">:</span>
</span><span id="Connection-329"><a href="#Connection-329"><span class="linenos">329</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;missing apdu sequence number&#39;</span><span class="p">)</span>
</span><span id="Connection-330"><a href="#Connection-330"><span class="linenos">330</span></a>
</span><span id="Connection-331"><a href="#Connection-331"><span class="linenos">331</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x8000</span>
</span><span id="Connection-332"><a href="#Connection-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_start_supervisory_timeout</span><span class="p">()</span>
</span><span id="Connection-333"><a href="#Connection-333"><span class="linenos">333</span></a>
</span><span id="Connection-334"><a href="#Connection-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="n">apdu</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span><span id="Connection-335"><a href="#Connection-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_receive_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">apdu</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="Connection-336"><a href="#Connection-336"><span class="linenos">336</span></a>
</span><span id="Connection-337"><a href="#Connection-337"><span class="linenos">337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Connection-338"><a href="#Connection-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_window_size</span><span class="p">:</span>
</span><span id="Connection-339"><a href="#Connection-339"><span class="linenos">339</span></a>            <span class="n">_write_apdu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">APDUS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span><span class="p">))</span>
</span><span id="Connection-340"><a href="#Connection-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection-341"><a href="#Connection-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_supervisory_timeout</span><span class="p">()</span>
</span><span id="Connection-342"><a href="#Connection-342"><span class="linenos">342</span></a>
</span><span id="Connection-343"><a href="#Connection-343"><span class="linenos">343</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_set_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ack</span><span class="p">):</span>
</span><span id="Connection-344"><a href="#Connection-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="n">ack</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ack</span><span class="p">:</span>
</span><span id="Connection-345"><a href="#Connection-345"><span class="linenos">345</span></a>            <span class="n">ssns</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ack</span><span class="p">,</span> <span class="n">ack</span><span class="p">)</span>
</span><span id="Connection-346"><a href="#Connection-346"><span class="linenos">346</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Connection-347"><a href="#Connection-347"><span class="linenos">347</span></a>            <span class="n">ssns</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ack</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">ack</span><span class="p">))</span>
</span><span id="Connection-348"><a href="#Connection-348"><span class="linenos">348</span></a>
</span><span id="Connection-349"><a href="#Connection-349"><span class="linenos">349</span></a>        <span class="k">for</span> <span class="n">ssn</span> <span class="ow">in</span> <span class="n">ssns</span><span class="p">:</span>
</span><span id="Connection-350"><a href="#Connection-350"><span class="linenos">350</span></a>            <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_handles</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ssn</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Connection-351"><a href="#Connection-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">handle</span><span class="p">:</span>
</span><span id="Connection-352"><a href="#Connection-352"><span class="linenos">352</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;received ack for unsent sequence number&quot;</span><span class="p">)</span>
</span><span id="Connection-353"><a href="#Connection-353"><span class="linenos">353</span></a>            <span class="n">handle</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="Connection-354"><a href="#Connection-354"><span class="linenos">354</span></a>
</span><span id="Connection-355"><a href="#Connection-355"><span class="linenos">355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ack</span> <span class="o">=</span> <span class="n">ack</span>
</span><span id="Connection-356"><a href="#Connection-356"><span class="linenos">356</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_cv</span><span class="p">:</span>
</span><span id="Connection-357"><a href="#Connection-357"><span class="linenos">357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_cv</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>
</span><span id="Connection-358"><a href="#Connection-358"><span class="linenos">358</span></a>
</span><span id="Connection-359"><a href="#Connection-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">_start_supervisory_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-360"><a href="#Connection-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span><span class="p">:</span>
</span><span id="Connection-361"><a href="#Connection-361"><span class="linenos">361</span></a>            <span class="k">return</span>
</span><span id="Connection-362"><a href="#Connection-362"><span class="linenos">362</span></a>
</span><span id="Connection-363"><a href="#Connection-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span>
</span><span id="Connection-364"><a href="#Connection-364"><span class="linenos">364</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_timeout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_supervisory_timeout</span><span class="p">)</span>
</span><span id="Connection-365"><a href="#Connection-365"><span class="linenos">365</span></a>
</span><span id="Connection-366"><a href="#Connection-366"><span class="linenos">366</span></a>    <span class="k">def</span> <span class="nf">_stop_supervisory_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection-367"><a href="#Connection-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span><span class="p">:</span>
</span><span id="Connection-368"><a href="#Connection-368"><span class="linenos">368</span></a>            <span class="k">return</span>
</span><span id="Connection-369"><a href="#Connection-369"><span class="linenos">369</span></a>
</span><span id="Connection-370"><a href="#Connection-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="Connection-371"><a href="#Connection-371"><span class="linenos">371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>

        </details>

            <div class="docstring"><p>Resource with lifetime control based on <code>Group</code>.</p>
</div>


                            <div id="Connection.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Connection</span><span class="signature">(
    conn: <a href="../tcp.html#Connection">hat.drivers.tcp.Connection</a>,
    always_enabled: bool,
    response_timeout: float,
    supervisory_timeout: float,
    test_timeout: float,
    send_window_size: int,
    receive_window_size: int
)</span>
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Connection.__init__-124"><a href="#Connection.__init__-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Connection.__init__-125"><a href="#Connection.__init__-125"><span class="linenos">125</span></a>                 <span class="n">conn</span><span class="p">:</span> <span class="n">tcp</span><span class="o">.</span><span class="n">Connection</span><span class="p">,</span>
</span><span id="Connection.__init__-126"><a href="#Connection.__init__-126"><span class="linenos">126</span></a>                 <span class="n">always_enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="Connection.__init__-127"><a href="#Connection.__init__-127"><span class="linenos">127</span></a>                 <span class="n">response_timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Connection.__init__-128"><a href="#Connection.__init__-128"><span class="linenos">128</span></a>                 <span class="n">supervisory_timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Connection.__init__-129"><a href="#Connection.__init__-129"><span class="linenos">129</span></a>                 <span class="n">test_timeout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Connection.__init__-130"><a href="#Connection.__init__-130"><span class="linenos">130</span></a>                 <span class="n">send_window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Connection.__init__-131"><a href="#Connection.__init__-131"><span class="linenos">131</span></a>                 <span class="n">receive_window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Connection.__init__-132"><a href="#Connection.__init__-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="n">conn</span>
</span><span id="Connection.__init__-133"><a href="#Connection.__init__-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_always_enabled</span> <span class="o">=</span> <span class="n">always_enabled</span>
</span><span id="Connection.__init__-134"><a href="#Connection.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_enabled</span> <span class="o">=</span> <span class="n">always_enabled</span>
</span><span id="Connection.__init__-135"><a href="#Connection.__init__-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_response_timeout</span> <span class="o">=</span> <span class="n">response_timeout</span>
</span><span id="Connection.__init__-136"><a href="#Connection.__init__-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_timeout</span> <span class="o">=</span> <span class="n">supervisory_timeout</span>
</span><span id="Connection.__init__-137"><a href="#Connection.__init__-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_test_timeout</span> <span class="o">=</span> <span class="n">test_timeout</span>
</span><span id="Connection.__init__-138"><a href="#Connection.__init__-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_send_window_size</span> <span class="o">=</span> <span class="n">send_window_size</span>
</span><span id="Connection.__init__-139"><a href="#Connection.__init__-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_window_size</span> <span class="o">=</span> <span class="n">receive_window_size</span>
</span><span id="Connection.__init__-140"><a href="#Connection.__init__-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_queue</span> <span class="o">=</span> <span class="n">aio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="Connection.__init__-141"><a href="#Connection.__init__-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span> <span class="o">=</span> <span class="n">aio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="Connection.__init__-142"><a href="#Connection.__init__-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_test_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="Connection.__init__-143"><a href="#Connection.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ssn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection.__init__-144"><a href="#Connection.__init__-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rsn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection.__init__-145"><a href="#Connection.__init__-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ack</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection.__init__-146"><a href="#Connection.__init__-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Connection.__init__-147"><a href="#Connection.__init__-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_supervisory_handle</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Connection.__init__-148"><a href="#Connection.__init__-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_handles</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Connection.__init__-149"><a href="#Connection.__init__-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waiting_ack_cv</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>
</span><span id="Connection.__init__-150"><a href="#Connection.__init__-150"><span class="linenos">150</span></a>
</span><span id="Connection.__init__-151"><a href="#Connection.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">async_group</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_loop</span><span class="p">)</span>
</span><span id="Connection.__init__-152"><a href="#Connection.__init__-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">async_group</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_loop</span><span class="p">)</span>
</span><span id="Connection.__init__-153"><a href="#Connection.__init__-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">async_group</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_loop</span><span class="p">)</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="Connection.async_group" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Connection.async_group">#&nbsp;&nbsp</a>

        <span class="name">async_group</span><span class="annotation">: hat.aio.Group</span>
    </div>

    
            <div class="docstring"><p>Group controlling resource's lifetime.</p>
</div>


                            </div>
                            <div id="Connection.info" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Connection.info">#&nbsp;&nbsp</a>

        <span class="name">info</span><span class="annotation">: <a href="../tcp.html#ConnectionInfo">hat.drivers.tcp.ConnectionInfo</a></span>
    </div>

    
    

                            </div>
                            <div id="Connection.send" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.send">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">send</span><span class="signature">(self, data: Union[bytes, bytearray, memoryview])</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Connection.send-163"><a href="#Connection.send-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">common</span><span class="o">.</span><span class="n">Bytes</span><span class="p">):</span>
</span><span id="Connection.send-164"><a href="#Connection.send-164"><span class="linenos">164</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection.send-165"><a href="#Connection.send-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Connection.send-166"><a href="#Connection.send-166"><span class="linenos">166</span></a>
</span><span id="Connection.send-167"><a href="#Connection.send-167"><span class="linenos">167</span></a>        <span class="k">except</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">:</span>
</span><span id="Connection.send-168"><a href="#Connection.send-168"><span class="linenos">168</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">()</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="Connection.drain" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.drain">#&nbsp;&nbsp</a>

        
            <span class="def">async def</span>
            <span class="name">drain</span><span class="signature">(self)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Connection.drain-170"><a href="#Connection.drain-170"><span class="linenos">170</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">drain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Connection.drain-171"><a href="#Connection.drain-171"><span class="linenos">171</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection.drain-172"><a href="#Connection.drain-172"><span class="linenos">172</span></a>            <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>
</span><span id="Connection.drain-173"><a href="#Connection.drain-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_send_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span><span id="Connection.drain-174"><a href="#Connection.drain-174"><span class="linenos">174</span></a>            <span class="k">await</span> <span class="n">future</span>
</span><span id="Connection.drain-175"><a href="#Connection.drain-175"><span class="linenos">175</span></a>
</span><span id="Connection.drain-176"><a href="#Connection.drain-176"><span class="linenos">176</span></a>        <span class="k">except</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">:</span>
</span><span id="Connection.drain-177"><a href="#Connection.drain-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">()</span>
</span><span id="Connection.drain-178"><a href="#Connection.drain-178"><span class="linenos">178</span></a>
</span><span id="Connection.drain-179"><a href="#Connection.drain-179"><span class="linenos">179</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div id="Connection.receive" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.receive">#&nbsp;&nbsp</a>

        
            <span class="def">async def</span>
            <span class="name">receive</span><span class="signature">(self) -&gt; Union[bytes, bytearray, memoryview]</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Connection.receive-181"><a href="#Connection.receive-181"><span class="linenos">181</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">common</span><span class="o">.</span><span class="n">Bytes</span><span class="p">:</span>
</span><span id="Connection.receive-182"><a href="#Connection.receive-182"><span class="linenos">182</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Connection.receive-183"><a href="#Connection.receive-183"><span class="linenos">183</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Connection.receive-184"><a href="#Connection.receive-184"><span class="linenos">184</span></a>
</span><span id="Connection.receive-185"><a href="#Connection.receive-185"><span class="linenos">185</span></a>        <span class="k">except</span> <span class="n">aio</span><span class="o">.</span><span class="n">QueueClosedError</span><span class="p">:</span>
</span><span id="Connection.receive-186"><a href="#Connection.receive-186"><span class="linenos">186</span></a>            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">()</span>
</span></pre></div>

        </details>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>hat.aio.Resource</dt>
                                <dd id="Connection.is_open" class="variable">is_open</dd>
                <dd id="Connection.is_closing" class="variable">is_closing</dd>
                <dd id="Connection.is_closed" class="variable">is_closed</dd>
                <dd id="Connection.wait_closing" class="function">wait_closing</dd>
                <dd id="Connection.wait_closed" class="function">wait_closed</dd>
                <dd id="Connection.close" class="function">close</dd>
                <dd id="Connection.async_close" class="function">async_close</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>